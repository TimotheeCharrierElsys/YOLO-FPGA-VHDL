#! /bin/bash
# cd C:/Users/UF523TCH/Documents/GIT/YOLO-FPGA-VHDL

echo "Removing libs"

vdel -lib ./LIB/LIB_RTL -all
vdel -lib ./LIB/LIB_BENCH -all

echo "Creating libs"

vlib ./LIB/LIB_RTL
vmap LIB_RTL ./LIB/LIB_RTL
vlib ./LIB/LIB_BENCH
vmap LIB_BENCH ./LIB/LIB_BENCH

echo "Compiling RTL sources"

vcom -2008 -check_synthesis -work LIB_RTL ./SRC/RTL/conv_pkg.vhd
vcom -2008 -check_synthesis -work LIB_RTL ./SRC/RTL/common/register_gen.vhd
vcom -2008 -check_synthesis -work LIB_RTL ./SRC/RTL/common/add_layer.vhd
vcom -2008 -check_synthesis -work LIB_RTL ./SRC/RTL/common/mult_layer.vhd
vcom -2008 -check_synthesis -work LIB_RTL ./SRC/RTL/common/dotproduct.vhd
# vcom -2008 -check_synthesis -work LIB_RTL ./SRC/RTL/common/convolution.vhd

vcom -2008 -check_synthesis -work LIB_RTL ./SRC/RTL/dotproduct/dotproduct.vhd
# vcom -2008 -check_synthesis -work LIB_RTL ./SRC/RTL/matmult/matmult_core.vhd
# vcom -2008 -check_synthesis -work LIB_RTL ./SRC/RTL/matmult/matmult_top.vhd
# vcom -2008 -check_synthesis - work LIB_RTL ./SRC/RTL/matmult.vhd

echo "Compiling BENCH sources"

# vcom -work LIB_BENCH ./SRC/BENCH/common/register_gen_tb.vhd
# vsim LIB_BENCH.register_gen_tb_conf
# do ./SRC/WAVEFORM/register_gen_tb_wave.do
# run 100 ns

# vcom -work LIB_BENCH ./SRC/BENCH/common/add_layer_tb.vhd
# vsim LIB_BENCH.add_layer_tb_conf
# do ./SRC/WAVEFORM/add_layer_tb_wave.do
# run 100 ns

# vcom -work LIB_BENCH ./SRC/BENCH/common/mult_layer_tb.vhd
# vsim LIB_BENCH.mult_layer_tb_conf
# do ./SRC/WAVEFORM/mult_layer_tb_wave.do
# run 100 ns

vcom -work LIB_BENCH ./SRC/BENCH/common/dotproduct_tb.vhd
vsim LIB_BENCH.dotproduct_tb_conf
do ./SRC/WAVEFORM/dotproduct_tb_wave.do
run 100 ns

# vcom -work LIB_BENCH ./SRC/BENCH/common/convolution_tb.vhd
# vsim LIB_BENCH.convolution_tb_conf
# do ./SRC/WAVEFORM/convolution_tb_wave.do
# run 100 ns

# vcom -work LIB_BENCH ./SRC/BENCH/dotproduct/dotproduct_tb.vhd
# vsim LIB_BENCH.dotproduct_top_tb_conf
# do ./SRC/WAVEFORM/dotproduct_top_tb_wave.do
# run 100 ns

# vcom -work LIB_BENCH ./SRC/BENCH/matmult/matmult_core_tb.vhd
# vsim LIB_BENCH.matmult_core_tb_conf
# do ./SRC/WAVEFORM/matmult_core_tb_wave.do
# run 100 ns

# vcom -work LIB_BENCH ./SRC/BENCH/matmult/matmult_top_tb.vhd
# vsim LIB_BENCH.matmult_top_tb_conf
# do ./SRC/WAVEFORM/matmult_top_tb_wave.do
# run 100 ns